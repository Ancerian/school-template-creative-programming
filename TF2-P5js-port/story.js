const story = {
  // Вспомогательные флаги для отслеживания действий игрока.
  // Эти флаги должны быть реализованы и управляться в коде игры.
  // hasLickedProtein: false,
  // befriendedSoldier: false,

  // ЛОКАЦІЯ: Тренажёрний зал (основний зал) - Начало
  scene1: {
    background: "images/темний зал.png",
    text: "Ніч. Зал порожній. Сигналізація не спрацювала. Камери обриваються о 03:14. На підлозі — протеїновий слід.",
    next: "scene2"
  },

  scene2: {
    background: "images/темний зал.png",
    text: "Розвідник (про себе): \"Щось тут не так... Треба вирішити, з чого почати розслідування.\"",
    choices: [
      { text: "Перевірити камери та консоль безпеки .", next: "security" },
      { text: "Проанализувати сліди протеїну .", next: "protein" }
    ]
  },

  // ЛОКАЦІЯ: Комната охраны (Ветка A1)
  security: {
    background: "images/темний зал.png",
    text: "Ти підійшов до консолі безпеки й побачив, що камера обривається о 03:14. Останні кадри — тінь з великим рюкзаком.",
    choices: [
      { text: "Спробувати відновити кадри за допомогою переносного термінала.", next: "hacker" },
      { text: "Перевірити список входів за ключ-картами.", next: "id" }
    ]
  },

  // Ветка взлому камер (расширение)
  hacker: {
    background: "images/темний зал.png",
    text: "Підключаю термінал... Виявлено перешкоду: кодований сигнал.",
    choices: [
      { text: "Запустити перший алгоритм дешифрування.", next: "decrypt_attempt1" },
      { text: "Це не мій профіль. Потрібна допомога Інженера?", next: "initial_findings_review" } // Альтернативный выход до обзора
    ]
  },

  decrypt_attempt1: {
    background: "images/темний зал.png",
    text: "Алгоритм працює... Прогрес: 30%. Сигнал сильний, потрібні додаткові потужності або інший підхід.",
    choices: [
      { text: "Запустити більш потужний алгоритм.", next: "decrypt_attempt2" },
      { text: "Ризиковано. Повернутися до інших методів?", next: "id" } // Можно вернуться к ветке ID
    ]
  },

  decrypt_attempt2: {
    background: "images/темний зал.png",
    text: "Запускаю... Здається, пробиваємося!",
    choices: [
      { text: "Продовжувати дешифрування.", next: "decryption_success" },
      { text: "Збій! Перевантаження системи!", next: "decryption_fail" }
    ]
  },

  decryption_success: {
    background: "images/темний зал.png",
    text: "Успіх! Розшифровано фрагмент запису: хтось із величезним рюкзаком пройшов до задніх приміщень о 03:14. Схоже, він щось виніс саме в момент обриву запису.",
    next: "found_encrypted_clue"
  },

  found_encrypted_clue: {
    background: "images/темний зал.png",
    text: "Тепер є доказ, що хтось щось виніс і пішов углиб комплексу. Час зібрати все, що вже знайшов.",
    next: "initial_findings_review" // Ведет к обзору перед встречей
  },

  decryption_fail: {
    background: "images/темний зал.png",
    text: "Система безпеки заблокована! Камери тепер недоступні. І здається, це привернуло увагу.",
    next: "system_feedback_jolt" // Сцена последствия
  },

  // Сцена последствия сбоя
  system_feedback_jolt: {
      background: "images/темний зал.png", // Возможно, другой фон для эффекта
      text: "Відчуваєш легкий удар струму від консолі. Система захисту спрацювала проти тебе. Це точно неспроста. Треба рухатись далі.",
      next: "initial_findings_review" // Ведет к обзору перед встречей
  },


  // Ветка проверки ID-карт
  id: {
    background: "images/темний зал.png",
    text: "Перевіряю лог... Виявлено анонімний вхід о 03:10 — без ID. Хтось обійшов систему. Це професійна робота.",
    next: "id_consequence"
  },

  id_consequence: {
    background: "images/темний зал.png",
    text: "Обійти систему ID-карт непросто. Це міг зробити хтось зсередини, або хтось із дуже хорошим обладнанням. Ця інформація може бути ключовою.",
    next: "initial_findings_review" // Ведет к обзору перед встречей
  },

  // ЛОКАЦІЯ: У тренажёра с гелем (Ветка A2)
  protein: {
    background: "images/темний зал.png",
    text: "На підлозі гель, поруч дозатор. Хтось модифікував тренажер і з'єднав його з шейкером. Усередині трохи світної рідини.",
    choices: [
      { text: "Взяти зразок і проаналізувати пізніше.", next: "initial_findings_review" }, // Ведет к обзору перед встречей
      { text: "Облизати... е-е... в наукових цілях!", next: "shaker" }
    ]
  },

  shaker: {
    background: "images/темний зал.png",
    text: "Фу. Ваніль і щось... радіоактивне? Непогано. Треба буде доповісти. *Відчуваєш легке запаморочення і світ здається трохи яскравішим*",
    // В этом месте игровой код должен установить флаг hasLickedProtein = true;
    next: "initial_findings_review" // Ведет к обзору перед встречей
  },

  // СЦЕНА ОБЗОРА ПЕРВОНАЧАЛЬНЫХ НАХОДОК
  initial_findings_review: {
      background: "images/темний зал.png",
      text: "Ти зібрав перші докази: обрив камер, можливий винос чогось, анонімний вхід та дивний протеїновий слід. Кому б про це розповісти? Солдат завжди тут...",
      next: "enginer" // Переход к встрече с Солдатом
  },

  // ЛОКАЦІЯ: Угловая зона зала (Солдат)
  enginer: {
    background: "images/темний зал.png",
    text: "Розвідник підходить до Солдата, який завзято тренується.",
    next: "enginer1"
  },

  enginer1: {
    background: "images/темний зал.png",
    text: "Солдат (між вправами): \"Мої сни стали реальністю! Гантелі літали, а я лежав і покривався потом доблесті! Найкраще тренування! А що?\" Розвідник: \"Чувак, тут сталося щось дивне. Зникнення, камери... Ти бачив щось минулої ночі?\"",
    choices: [
      { text: "Поділитися знахідками (гель, камери, ID) і попросити допомогти.", next: "hero" }, // Ветка B1
      { text: "Обвинуватити в диверсії (в шутку).", next: "joke" } // Ветка B2
    ]
  },

  hero: {
    background: "images/темний зал.png",
    text: "Солдат слухає, його обличчя стає серйознішим. \"Гм, літаючі гантелі - це, звісно, сила... Але допомога товаришу важливіша! Показуй, що там у тебе! Розслідування - це як поле бою, тільки без крові! Ну, зазвичай...\" Він обіцяє допомогти.",
    // В этом месте игровой код должен установить флаг befriendedSoldier = true;
    next: "check_secret" // Проверка условий для секретной ветки
  },

  joke: {
    background: "images/темний зал.png",
    text: "Солдат регоче. \"Та ні, я просто качався! Не переймайся, Розвідник, для мене це звичайна справа! Я - машина для тренувань!\" Він не сприймає тебе серйозно, але згоден допомогти, якщо ти 'розжуєш' йому завдання.",
    next: "check_secret" // Проверка условий для секретной ветки
  },

  // СЦЕНА ПРОВЕРКИ УСЛОВИЙ ДЛЯ СЕКРЕТНОЙ КОНЦОВКИ
  // В этом месте игровой код должен проверить флаги hasLickedProtein И befriendedSoldier.
  // Если оба true, переходим на investigation_secret. Иначе - на investigation.
  check_secret: {
      background: "images/темний зал.png",
      text: "Розвідник обмірковує зібрані докази та реакцію Солдата...",
      // next: "investigation" // Плейсхолдер. Здесь должна быть логика проверки флагов
      // Если hasLickedProtein && befriendedSoldier: next: "investigation_secret"
      // Иначе: next: "investigation"
      // В коде игры нужно сделать реальную условную переадресацию.
      // Для примера укажем куда-то по умолчанию:
      next: "investigation" // <--- Эту строку нужно заменить логикой в коде игры!
  },


  // ЛОКАЦІЯ: Мастерская инженера (Общая ветка расследования)
  investigation: {
    background: "images/темний зал.png",
    text: "У майстерні Інженера знаходите розкидані записи. Виявлено звіт: тест гелю, нестабільний дозатор, підпис «експеримент Н42: важка маса, висока щільність». Це виглядає як науковий проєкт...",
     // Дополнительный текст, если дешифровка камер была успешной
     // "Згадуєш розшифровані кадри: Heavy ніс щось важке. Це може бути пов'язано з цим гелем."
    choices: [
      { text: "Сфотографувати записи і відправити Медику для аналізу.", next: "medic" },
      { text: "Поспрабувати зламати сейф під столом.", next: "safe" }
    ]
  },

  medic: {
    background: "images/темний зал.png",
    text: "Надсилаєш записи Медику. Його відповідь: \"Цікаво... Надзвичайно висока щільність для органічного гелю. Схоже на... стабільну темну матерію? Негайно до мене! Або ні, краще сам розберися, я зайнятий! І обережніше, я відчуваю дивні енергетичні сплески в тій зоні!\".",
    next: "final" // Медик отправляет тебя дальше
  },

  safe: {
    background: "images/темний зал.png",
    text: "Сейф виявився простим. Всередині — стара форма Heavy з нашивкою «Ghost Gym». Це щось означає. Можливо, це назва команди чи проєкту?",
    next: "final" // Находка ведет к финалу
  },

  // ЛОКАЦІЯ: Тайная комната за зеркалом (Общая финальная ветка)
  final: {
    background: "images/темний зал.png", // Возможно, фон другой для тайной комнаты
    text: "Ти знаходиш приховані двері за дзеркалом у залі, про які, можливо, згадувалося в записах або від Солдата. Входиш... Там, у сяйві тренажерів та дивного обладнання, стоїть Heavy, витираючи гантелю.",
    choices: [
      { text: "Вступити в Секретний фітнес-загін (Фінал A).", next: "endingA" },
      { text: "Здати їх керівництву Mann Co. (Фінал B).", next: "endingB" },
      { text: "Попросити натренувати як елітного суперкачка (Фінал C).", next: "endingC" }
    ]
  },

  endingA: {
    background: "images/темний зал.png", // Финальный фон
    text: "Heavy киває. \"Ти гідний. Відтепер ти частина 'Ghost Gym'. Сила не приходить сама по собі, її треба качати!\" Розвідник отримує нове спорядження та завдання захищати секрети фітнесу Mann Co.",
    next: "endingA_post"
  },

  endingA_post: {
      background: "images/темний зал.png", // Тот же фон или другой для эпилога
      text: "Ти став агентом під прикриттям. Тренування виснажливі, але відчуваєш, як стаєш сильнішим. Ваша мета — не допустити, щоб хтось дізнався про таємниці 'Ghost Gym'.",
      next: "credits"
  },

  endingB: {
    background: "images/темний зал.png", // Финальный фон
    text: "Ти зв'язуєшся з Mann Co. Проєкт терміново згортають, все обладнання вивозять, а Heavy та його команда зникають без сліду, наче їх і не було. Розвіднику видають медаль \"Герой Залу\"...",
    next: "endingB_post"
  },

   endingB_post: {
      background: "images/темний зал.png", // Тот же фон или другой для эпилога
      text: "...і купу паперової роботи та допитів про те, що саме ти бачив. Зал повертається до свого звичайного стану, але ти знаєш, що там ховалося щось надзвичайне.",
      next: "credits"
  },

  endingC: {
    background: "images/темний зал.png", // Финальный фон
    text: "Heavy посміхається. \"Хочеш качатися? Валяй! Я покажу тобі 'Експеримент Н42' на собі!\" Розвідник отримує дозу стабільної темної матерії та перетворюється...",
    next: "endingC_post"
  },

  endingC_post: {
      background: "images/темний зал.png", // Тот же фон или другой для эпилога
      text: "...на мутанта з однією гігантською, світною рукою, яка має неймовірну силу. Його кличуть \"Шейкермен\". Він корисний для перенесення важких речей, але грати в бейсбол стало складніше.",
      next: "credits"
  },

  // Кредиты
  credits: {
    background: "images/темний зал.png",
    text: "Дякуємо за гру! Твій вибір визначив долю героя. Спробуй інші варіанти!",
    // next: "scene1" // Можно раскомментировать для рестарта
  },


  // --- СЕКРЕТНА ВЕТКА (ДУБЛІКАТИ СЦЕН) ---
  // Активируется, если игрок облизал протеин И подружился с Солдатом,
  // переход осуществляется в сцене check_secret

  // ЛОКАЦІЯ: Мастерская инженера (Секретная ветка) - Дубликат investigation
  investigation_secret: {
    background: "images/темний зал.png", // Тот же фон, но другая сцена
    text: "У майстерні Інженера знаходиш розкидані записи... Але через ефект гелю та підтримку Солдата, ти бачиш набагато більше. На звіті про експеримент Н42 є приховані анотації, написані невидимими чорнилами! Також помічаєш дивну кнопку під столом, яка світиться ледь помітним зеленим світлом...",
    choices: [
      { text: "Уважно вивчити записи з прихованими анотаціями.", next: "medic_secret" },
      { text: "Натиснути на дивну кнопку під столом.", next: "safe_secret" } // Сейф чи щось інше?
    ]
  },

  medic_secret: {
    background: "images/темний зал.png", // Возможно, другой фон
    text: "Надсилаєш Медику фотографії записів. Його голос по рації тремтить, ніби він щойно побачив привида: \"Розвідник! Ці анотації... вони про... телепортаційні коливання! Гель - це лише каталізатор! Ти в зоні експериментальних викривлень простору! Це все... галюцинації?! Терміново відійди!\"",
    // Переход к секретной концовке после звонка Медика
    next: "secret_ending_scene"
  },

  safe_secret: {
    background: "images/темний зал.png",
    text: "Натискаєш на кнопку. Під столом висувається прихована панель, яка виглядає абсолютно нереально, ніби зроблена зі світла та тіні. На ній — один великий напис, який пульсує: \"ОСОЗНАНІЄ\".",
    // Переход к секретной концовке
    next: "secret_ending_scene"
  },

  // ЛОКАЦІЯ: Осознание (Секретная концовка) - Дубликат final, но совсем другой
  secret_ending_scene: {
      background: "images/темний зал.png", // Возможно, уникальный фон для этого состояния
      text: "Раптом стіни залу розпливаються. Ти відчуваєш, ніби твоє тіло розділяється на мільйони частинок. Це все... галюцинації?! Чи реальність, змінена експериментом Н42?! Чуєш спотворений голос Медика по рації:",
      // Диалог Медика из описания "Скрытой сцены"
      choices: [
           { text: "Медик (спотворено): \"Ну... я хотів протестувати побічні ефекти... в реальних умовах... Але раз ти вже в ділі... у нас є вакансія... в лабораторії...\"", next: "endingSecret" }
      ]
  },

  endingSecret: {
      background: "images/темний зал.png", // Финальный фон
      text: "Твоя доля вирішена. Ти не став суперкачком і не здав Heavy. Ти опинився в сюрреалістичній лабораторії Медика, де реальність гнучка, а ти - головний об'єкт досліджень. Ласкаво просимо у світ божевільних експериментів!",
      next: "endingSecret_post"
  },

  endingSecret_post: {
      background: "images/темний зал.png", // Тот же фон или другой для эпилога
      text: "Тепер твої дні проходять між дивними машинами та незрозумілими речовинами. Медик завжди поруч, щось бурмоче про викривлення простору та твій унікальний метаболізм після контакту з гелем.",
      next: "credits"
  }
}
